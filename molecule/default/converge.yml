---
- name: Converge
  hosts: all
  become: true

  vars:
    pip_install_packages:
      # Test installing a specific version of a package.
      - name: ipaddress
        version: "1.0.18"
      # Test installing a package by name.
      - colorama
      # Install a package into an virtualenv instead
      - name: ipaddress
        virtualenv: /virtualenv

  pre_tasks:
    - name: Update apt cache.
      apt: update_cache=true cache_valid_time=600
      when: ansible_os_family == 'Debian'

    - name: Set package name for older OSes.
      set_fact:
        pip_package: python-pip
      when: >
        (ansible_os_family == 'RedHat') and (ansible_distribution_major_version | int < 8)
        or (ansible_distribution == 'Debian') and (ansible_distribution_major_version | int < 10)
        or (ansible_distribution == 'Ubuntu') and (ansible_distribution_major_version | int < 18)

  roles:
    - role: geerlingguy.pip

- name: Converge with virtualenvs
  hosts: all
  become: true

  vars:
    # set virtualenv for all packages
    pip_virtualenv: /venv
    # install another package as dependency
    pip_virtualenv_packages:
      - virtualenv
      - python3-venv
    pip_umask: "0022"
    pip_install_packages:
      # Install into the default virtualenv
      - colorama
      # Install into a different virtualenv
      - name: pip-install-test
        virtualenv: /anothervenv
      # Install the same package in yet another virtualenv created with a different command
      - name: pip-install-test
        version: 0.5.0
        virtualenv: /yetanothervenv
        virtualenv_command: python3 -m venv

  pre_tasks:
    - name: Update apt cache.
      apt: update_cache=true cache_valid_time=600
      when: ansible_os_family == 'Debian'

    - name: Set package name for older OSes.
      set_fact:
        pip_package: python-pip
      when: >
        (ansible_os_family == 'RedHat') and (ansible_distribution_major_version | int < 8)
        or (ansible_distribution == 'Debian') and (ansible_distribution_major_version | int < 10)
        or (ansible_distribution == 'Ubuntu') and (ansible_distribution_major_version | int < 18)

  roles:
    - role: geerlingguy.pip
